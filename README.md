# ttlock-api
Тестовый проект ServiceBook ttlock-api — Управление Умными Замками через API Sciener
Описание проекта
ServiceBook — это серверное веб-приложение на PHP с использованием фреймворка Yii2, предназначенное для управления умными замками и кодами доступа к ним через интеграцию с API Sciener. Проект реализует полный набор функций для работы с замками, пользователями и паролями доступа, включая инициализацию замков, получение списка замков, добавление и удаление кодов клавиатуры, а также управление OAuth2 токенами пользователей.

Проект ориентирован на надежное хранение и трансформацию данных, использует архитектурные паттерны с использованием DTO, Value Objects и Hydrator, обеспечивая строгую типизацию и хорошую поддержку для расширения и тестирования.

Основные возможности
Управление замками

Инициализация замка через внешний API (Sciener)
Сохранение данных замков в базе данных
Получение списка замков по идентификатору клиента из БД
Получение информации по конкретному замку
Удаление замков через API
Работа с паролями доступа (PassCode)

Получение кодов клавиатуры для замка
Добавление новых кодов доступа
Удаление кодов через API
Управление пользователями

Получение OAuth2 токена доступа через API
Загрузка пользователей из базы с трансформацией в объекты-значения
Интеграция с внешним API Sciener

Выполнение HTTP-запросов к API с передачей параметров
Обработка ответов и ошибок от API
Работа с form-urlencoded POST запросами через cURL
Строгая типизация и архитектура

Использование Value Objects для всех идентификаторов, токенов, паролей и т.д.
DTO-объекты для безопасного обмена данными между слоями приложения
Hydrator для преобразования массивов/DTO в полностью типизированные сущности
Работа с базой данных

Использование Yii2 DB-команд для CRUD операций
Поддержка связей между замками, пользователями и паролями
Структура проекта
Модули
Repositories

Основной слой, который реализует взаимодействие как с внешним API Sciener, так и с локальной базой данных, обеспечивая при этом чистую архитектуру и изоляцию логики.

LockRepository — управление замками и кодами доступа, API запросы и локальное хранение.
TockenUserRepository — управление OAuth2 токенами пользователей, получение данных пользователей из базы.
Entities (Сущности)

Сущности с Value Objects, например, LockInit, PassCode, User и объекты идентификаторов, токенов, для строгого контроля состояний и значений.

DTO (Data Transfer Objects)

Объекты промежуточного уровня для передачи данных между слоями и преобразования из массива БД.

Hydrator

Сервис, который превращает массивы и DTO в объекты-сущности, поддерживая строгую типизацию.

Основные технологии
PHP 8+ с объявлением строгой типизации
Yii2 Framework
cURL для работы с внешними REST API
MySQL или другая реляционная БД для хранения пользователей и замков
JSON для обмена данными с API
Value Objects, DTO, Repository паттерны
Использование
Аутентификация пользователя

При помощи TockenUserRepository::GetAccessToken() происходит получение OAuth2 токена для взаимодействия с API.
Данные пользователя загружаются из локальной базы и гидрируются в сущность пользователя.
Управление замками

LockRepository::LockInit() инициализирует замок в системе Sciener и сохраняет данные в локальную базу.
getLocksByClientId() и getLockByLockId() позволяют получать информацию о замках у клиента.
LockDelete() удаляет замок через API.
Работа с кодами доступа

getPassCode() получает список или конкретный код доступа к замку.
addPassCode() добавляет новый временный или постоянный код доступа.
deletePassCode() удаляет существующий код, обеспечивая безопасность доступа.
Получение списка замков

LockList() возвращает полный список замков пользователя, вызывая соответствующий API.
Пояснения к архитектуре и качествам кода
Использование Value Objects повышает надежность, предотвращая ошибки типа и некорректные данные.
Реализация DTO и Hydrator упрощает поддержку, тестирование и изменение логики без изменений во всей системе.
Использование cURL и формата application/x-www-form-urlencoded соответствует требованиям API Sciener.
Обработка ошибок через собственные исключения NotFoundException гарантирует последовательное управление ошибками и понятные сообщения.
Использование Yii2 Db-команд позволяет эффективно и безопасно взаимодействовать с базой.
Итог
Проект ServiceBook ttlock-api демонстрирует современный подход к разработке бэкенда с интеграцией внешних сервисов управления умными замками. Четкое разделение логики, строгая типизация и использование паттернов делают код масштабируемым, поддерживаемым и адаптируемым под изменения API или бизнес-требований.
